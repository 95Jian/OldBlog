{"remainingRequest":"D:\\finalProject3\\Blog\\blog-cms\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\finalProject3\\Blog\\blog-cms\\src\\views\\blog\\blog\\WriteBlog.vue?vue&type=style&index=0&id=00baa937&scoped=true&lang=css","dependencies":[{"path":"D:\\finalProject3\\Blog\\blog-cms\\src\\views\\blog\\blog\\WriteBlog.vue","mtime":1724744615943},{"path":"D:\\finalProject3\\Blog\\blog-cms\\node_modules\\css-loader\\dist\\cjs.js","mtime":1724724134830},{"path":"D:\\finalProject3\\Blog\\blog-cms\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":1724724133448},{"path":"D:\\finalProject3\\Blog\\blog-cms\\node_modules\\postcss-loader\\src\\index.js","mtime":1724724133694},{"path":"D:\\finalProject3\\Blog\\blog-cms\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1724724146465},{"path":"D:\\finalProject3\\Blog\\blog-cms\\node_modules\\vue-loader\\lib\\index.js","mtime":1724724133444}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CkBpbXBvcnQgIn52ZGl0b3IvZGlzdC9pbmRleC5jc3MiOwo="},{"version":3,"sources":["WriteBlog.vue"],"names":[],"mappings":";AA6RA","file":"WriteBlog.vue","sourceRoot":"src/views/blog/blog","sourcesContent":["<template>\r\n\t<div>\r\n\t\t<!--面包屑导航-->\r\n\t\t<Breadcrumb parentTitle=\"博客管理\"/>\r\n\r\n\t\t<el-form :model=\"form\" :rules=\"formRules\" ref=\"formRef\" label-position=\"top\">\r\n\t\t\t<el-row :gutter=\"20\">\r\n\t\t\t\t<el-col :span=\"12\">\r\n\t\t\t\t\t<el-form-item label=\"标题\" prop=\"title\">\r\n\t\t\t\t\t\t<el-input v-model=\"form.title\" placeholder=\"请输入标题\"></el-input>\r\n\t\t\t\t\t</el-form-item>\r\n\t\t\t\t</el-col>\r\n\t\t\t\t<!-- <el-col :span=\"12\">\r\n\t\t\t\t\t<el-form-item label=\"封面图\" prop=\"firstPicture\">\r\n\t\t\t\t\t\t<el-input v-model=\"form.firstPicture\" placeholder=\"可不填，随机获取\"></el-input>\r\n\t\t\t\t\t</el-form-item>\r\n\t\t\t\t</el-col> -->\r\n\t\t\t</el-row>\r\n\r\n\t\t\t<!-- <el-alert title=\"注意：如果从 Typora 中复制 Markdown，粘贴时要选择粘贴为纯文本，\r\n\t\t\t 否则代码块可能无法被 prismjs 高亮\" type=\"warning\" center show-icon></el-alert> -->\r\n\r\n\t\t\t<el-form-item label=\"描述\" prop=\"description\">\r\n\t\t\t\t<div id=\"vditor-description\"></div>\r\n\t\t\t</el-form-item>\r\n\r\n\t\t\t<el-form-item label=\"正文\" prop=\"content\">\r\n\t\t\t\t<div id=\"vditor-content\"></div>\r\n\t\t\t</el-form-item>\r\n\r\n\t\t\t<el-row :gutter=\"20\">\r\n\t\t\t\t<el-col :span=\"12\">\r\n\t\t\t\t\t<el-form-item label=\"分类\" prop=\"cate\">\r\n\t\t\t\t\t\t<el-select v-model=\"form.cate\" placeholder=\"请选择分类（输入可添加新分类）\" :allow-create=\"true\" :filterable=\"true\" style=\"width: 100%;\">\r\n\t\t\t\t\t\t\t<el-option :label=\"item.name\" :value=\"item.id\" v-for=\"item in categoryList\" :key=\"item.id\"></el-option>\r\n\t\t\t\t\t\t</el-select>\r\n\t\t\t\t\t</el-form-item>\r\n\t\t\t\t</el-col>\r\n\t\t\t\t<el-col :span=\"12\">\r\n\t\t\t\t\t<el-form-item label=\"标签\" prop=\"tagList\">\r\n\t\t\t\t\t\t<el-select v-model=\"form.tagList\" placeholder=\"请选择标签（输入可添加新标签）\" :allow-create=\"true\" :filterable=\"true\" :multiple=\"true\" style=\"width: 100%;\">\r\n\t\t\t\t\t\t\t<el-option :label=\"item.name\" :value=\"item.id\" v-for=\"item in tagList\" :key=\"item.id\"></el-option>\r\n\t\t\t\t\t\t</el-select>\r\n\t\t\t\t\t</el-form-item>\r\n\t\t\t\t</el-col>\r\n\t\t\t</el-row>\r\n\r\n\t\t\t<!-- <el-form-item label=\"浏览次数\" prop=\"views\">\r\n\t\t\t\t<el-input v-model=\"form.views\" placeholder=\"文章访问量（默认为 0）\" type=\"number\" style=\"width: 50%;\"></el-input>\r\n\t\t\t</el-form-item> -->\r\n\r\n\t\t\t<el-form-item style=\"text-align: right;\">\r\n\t\t\t\t<el-button type=\"primary\" @click=\"dialogVisible=true\">保存</el-button>\r\n\t\t\t</el-form-item>\r\n\t\t</el-form>\r\n\r\n\t\t<!--编辑可见性状态对话框-->\r\n\t\t<el-dialog title=\"博客可见性\" width=\"30%\" :visible.sync=\"dialogVisible\">\r\n\t\t\t<!--内容主体-->\r\n\t\t\t<el-form label-width=\"50px\" @submit.native.prevent>\r\n\t\t\t\t<el-form-item>\r\n\t\t\t\t\t<el-radio-group v-model=\"radio\">\r\n\t\t\t\t\t\t<el-radio :label=\"1\">公开</el-radio>\r\n\t\t\t\t\t\t<el-radio :label=\"2\">私密</el-radio>\r\n\t\t\t\t\t\t<el-radio :label=\"3\">密码保护</el-radio>\r\n\t\t\t\t\t</el-radio-group>\r\n\t\t\t\t</el-form-item>\r\n\t\t\t\t<el-form-item label=\"密码\" v-if=\"radio===3\">\r\n\t\t\t\t\t<el-input v-model=\"form.password\"></el-input>\r\n\t\t\t\t</el-form-item>\r\n\t\t\t\t<el-form-item v-if=\"radio!==2\">\r\n\t\t\t\t\t<el-row>\r\n\t\t\t\t\t\t<!-- <el-col :span=\"6\">\r\n\t\t\t\t\t\t\t<el-switch v-model=\"form.appreciation\" active-text=\"赞赏\"></el-switch>\r\n\t\t\t\t\t\t</el-col> -->\r\n\t\t\t\t\t\t<el-col :span=\"6\">\r\n\t\t\t\t\t\t\t<el-switch v-model=\"form.recommend\" active-text=\"推荐\"></el-switch>\r\n\t\t\t\t\t\t</el-col>\r\n\t\t\t\t\t\t<!-- <el-col :span=\"6\">\r\n\t\t\t\t\t\t\t<el-switch v-model=\"form.commentEnabled\" active-text=\"评论\"></el-switch>\r\n\t\t\t\t\t\t</el-col> -->\r\n\t\t\t\t\t\t<el-col :span=\"6\">\r\n\t\t\t\t\t\t\t<el-switch v-model=\"form.top\" active-text=\"置顶\"></el-switch>\r\n\t\t\t\t\t\t</el-col>\r\n\t\t\t\t\t</el-row>\r\n\t\t\t\t</el-form-item>\r\n\t\t\t</el-form>\r\n\t\t\t<!--底部-->\r\n\t\t\t<span slot=\"footer\">\r\n\t\t\t\t<el-button @click=\"dialogVisible=false\">取 消</el-button>\r\n\t\t\t\t<el-button type=\"primary\" @click=\"submit\">保存</el-button>\r\n\t\t\t</span>\r\n\t\t</el-dialog>\r\n\t</div>\r\n</template>\r\n\r\n<script>\r\n\timport Breadcrumb from \"@/components/Breadcrumb\";\r\n\timport {getCategoryAndTag, saveBlog, getBlogById, updateBlog} from '@/api/blog'\r\n\timport Vditor from 'vditor'\r\n\r\n\texport default {\r\n\t\tname: \"WriteBlog\",\r\n\t\tcomponents: {Breadcrumb},\r\n\t\tdata() {\r\n\t\t\treturn {\r\n\t\t\t\tready: false,\r\n\t\t\t\tdescriptionVditor: null,\r\n\t\t\t\tcontentVditor: null,\r\n\t\t\t\tcategoryList: [],\r\n\t\t\t\ttagList: [],\r\n\t\t\t\tdialogVisible: false,\r\n\t\t\t\tradio: 1,\r\n\t\t\t\tform: {\r\n\t\t\t\t\ttitle: '',\r\n\t\t\t\t\tfirstPicture: '',\r\n\t\t\t\t\tdescription: '',\r\n\t\t\t\t\tcontent: '',\r\n\t\t\t\t\tcate: null,\r\n\t\t\t\t\ttagList: [],\r\n\t\t\t\t\twords: null,\r\n\t\t\t\t\treadTime: null,\r\n\t\t\t\t\tviews: 0,\r\n\t\t\t\t\tappreciation: false,\r\n\t\t\t\t\trecommend: false,\r\n\t\t\t\t\tcommentEnabled: false,\r\n\t\t\t\t\ttop: false,\r\n\t\t\t\t\tpublished: false,\r\n\t\t\t\t\tpassword: '',\r\n\t\t\t\t},\r\n\t\t\t\tformRules: {\r\n\t\t\t\t\ttitle: [{required: true, message: '请输入标题', trigger: 'change'}],\r\n\t\t\t\t\t//firstPicture: [{required: true, message: '请输入首图链接', trigger: 'change'}],\r\n\t\t\t\t\tcate: [{required: true, message: '请选择分类', trigger: 'change'}],\r\n\t\t\t\t\t// tagList: [{required: true, message: '请选择标签', trigger: 'change'}],\r\n\t\t\t\t},\r\n\t\t\t}\r\n\t\t},\r\n\t\tcreated() {\r\n\t\t\tthis.getData()\r\n\t\t},\r\n\t\tmounted() {\r\n\t\t\tthis.initDescriptionVditor()\r\n\t\t\tthis.initContentVditor()\r\n\t\t},\r\n\t\tmethods: {\r\n\t\t\t//初始化md编辑器\r\n\t\t\tinitDescriptionVditor() {\r\n\t\t\t\tconst options = {\r\n\t\t\t\t\theight: 320,\r\n\t\t\t\t\tmode: 'sv',//分屏渲染\r\n\t\t\t\t\toutline: true,//大纲\r\n\t\t\t\t\tcache: {//不缓存到localStorage\r\n\t\t\t\t\t\tenable: false,\r\n\t\t\t\t\t},\r\n\t\t\t\t\tresize: {//可调整高度\r\n\t\t\t\t\t\tenable: true\r\n\t\t\t\t\t},\r\n\t\t\t\t\tafter: () => {\r\n\t\t\t\t\t\tif (!this.ready) {\r\n\t\t\t\t\t\t\tthis.ready = true //两个编辑器都加载完成后执行，避免重复请求\r\n\t\t\t\t\t\t} else if (this.$route.params.id) {\r\n\t\t\t\t\t\t\tthis.getBlog(this.$route.params.id)\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tthis.descriptionVditor = new Vditor('vditor-description', options)\r\n\t\t\t},\r\n\t\t\tinitContentVditor() {\r\n\t\t\t\tconst options = {\r\n\t\t\t\t\theight: 640,\r\n\t\t\t\t\tmode: 'sv',//分屏渲染\r\n\t\t\t\t\toutline: true,//大纲\r\n\t\t\t\t\tcache: {//不缓存到localStorage\r\n\t\t\t\t\t\tenable: false,\r\n\t\t\t\t\t},\r\n\t\t\t\t\tresize: {//可调整高度\r\n\t\t\t\t\t\tenable: true\r\n\t\t\t\t\t},\r\n\t\t\t\t\tafter: () => {\r\n\t\t\t\t\t\tif (!this.ready) {\r\n\t\t\t\t\t\t\tthis.ready = true\r\n\t\t\t\t\t\t} else if (this.$route.params.id) {\r\n\t\t\t\t\t\t\tthis.getBlog(this.$route.params.id)\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tthis.contentVditor = new Vditor('vditor-content', options)\r\n\t\t\t},\r\n\t\t\tgetBlog(id) {\r\n\t\t\t\t//编辑博客\r\n\t\t\t\tgetBlogById(id).then(res => {\r\n\t\t\t\t\tif (res.code === 200) {\r\n\t\t\t\t\t\tthis.computeCategoryAndTag(res.data)\r\n\t\t\t\t\t\t// this.msgSuccess(res.msg);\r\n\t\t\t\t\t\tthis.form = res.data\r\n\t\t\t\t\t\tthis.descriptionVditor.setValue(this.form.description)\r\n\t\t\t\t\t\tthis.contentVditor.setValue(this.form.content)\r\n\t\t\t\t\t\tthis.radio = this.form.published ? (this.form.password !== '' ? 3 : 1) : 2\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tthis.msgError(res.msg)\r\n\t\t\t\t\t}\r\n\t\t\t\t}).catch(() => {\r\n\t\t\t\t\tthis.msgError('请求失败')\r\n\t\t\t\t})\r\n\t\t\t},\r\n\t\t\tcomputeCategoryAndTag(blog) {\r\n\t\t\t\tblog.cate = blog.category.id\r\n\t\t\t\tblog.tagList = []\r\n\t\t\t\tblog.tags.forEach(item => {\r\n\t\t\t\t\tblog.tagList.push(item.id)\r\n\t\t\t\t})\r\n\t\t\t},\r\n\t\t\tgetData() {\r\n\t\t\t\t//获取目录和标签\r\n\t\t\t\tgetCategoryAndTag().then(res => {\r\n\t\t\t\t\tif (res.code === 200) {\r\n\t\t\t\t\t\t// this.msgSuccess(res.msg);\r\n\t\t\t\t\t\tthis.categoryList = res.data.categories\r\n\t\t\t\t\t\tthis.tagList = res.data.tags\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tthis.msgError(res.msg)\r\n\t\t\t\t\t}\r\n\t\t\t\t}).catch(() => {\r\n\t\t\t\t\tthis.msgError('请求失败')\r\n\t\t\t\t})\r\n\t\t\t},\r\n\t\t\tsubmit() {\r\n\t\t\t\tif (this.radio === 3 && (this.form.password === '' || this.form.password === null)) {\r\n\t\t\t\t\treturn this.msgError(\"密码保护模式必须填写密码！\")\r\n\t\t\t\t}\r\n\t\t\t\tthis.$refs.formRef.validate(valid => {\r\n\t\t\t\t\tif (valid) {\r\n\t\t\t\t\t\tthis.form.description = this.descriptionVditor.getValue()\r\n\t\t\t\t\t\tthis.form.content = this.contentVditor.getValue()\r\n\t\t\t\t\t\tif (this.radio === 2) {\r\n\t\t\t\t\t\t\tthis.form.appreciation = false\r\n\t\t\t\t\t\t\tthis.form.recommend = false\r\n\t\t\t\t\t\t\tthis.form.commentEnabled = false\r\n\t\t\t\t\t\t\tthis.form.top = false\r\n\t\t\t\t\t\t\tthis.form.published = false\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tthis.form.published = true\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif (this.radio !== 3) {\r\n\t\t\t\t\t\t\tthis.form.password = ''\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif (this.$route.params.id) {\r\n\t\t\t\t\t\t\tthis.form.category = null\r\n\t\t\t\t\t\t\tthis.form.tags = null\r\n\t\t\t\t\t\t\tupdateBlog(this.form).then(res => {\r\n\t\t\t\t\t\t\t\tif (res.code === 200) {\r\n\t\t\t\t\t\t\t\t\tthis.msgSuccess(res.msg)\r\n\t\t\t\t\t\t\t\t\tthis.$router.push('/blogs')\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\tthis.msgError(res.msg)\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}).catch(() => {\r\n\t\t\t\t\t\t\t\tthis.msgError('请求失败')\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tsaveBlog(this.form).then(res => {\r\n\t\t\t\t\t\t\t\tif (res.code === 200) {\r\n\t\t\t\t\t\t\t\t\tthis.msgSuccess(res.msg)\r\n\t\t\t\t\t\t\t\t\tthis.$router.push('/blogs')\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\tthis.msgError(res.msg)\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}).catch(() => {\r\n\t\t\t\t\t\t\t\tthis.msgError('请求失败')\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tthis.dialogVisible = false\r\n\t\t\t\t\t\treturn this.msgError('请填写必要的表单项')\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n</script>\r\n\r\n<style scoped>\r\n\t@import \"~vditor/dist/index.css\";\r\n</style>"]}]}